<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN">
<HTML
><HEAD
><TITLE
>4.3 Measuring Custom Benchmark Program Performance</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.7"><LINK
REL="HOME"
TITLE="HDF5 Performance Framework User Manual"
HREF="book1.html"><LINK
REL="UP"
TITLE="Writing Custom Benchmark Program"
HREF="c160.html"><LINK
REL="PREVIOUS"
TITLE="4.2 Creating Custom Routine, Action and Instance Name"
HREF="x196.html"><LINK
REL="NEXT"
TITLE="Testing HPF "
HREF="c229.html"></HEAD
><BODY
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>HDF5 Performance Framework User Manual</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="x196.html"
ACCESSKEY="P"
>&#60;&#60;&#60; Previous</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>Writing Custom Benchmark Program</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="c229.html"
ACCESSKEY="N"
>Next &#62;&#62;&#62;</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="AEN215"
>4.3 Measuring Custom Benchmark Program Performance</A
></H1
>
<P
>Once you've modified variables for your routine, action and instance names, it's time to measure the performance of your benchmarking program.
In this section, we will not cover the details of how to write programs with HDF5 library since there are plenty of tutorial examples on the main HDF web site.
Rather, we'll focus on how to inject your HDF5 program into our tutorial example.</P
>

<P
>Adding your own program into HPF is as simple as putting a letter into an envelop. 
All you have to do is to insert your own program between two API pairs called  <TT
CLASS="FUNCTION"
>H5Perf_startTimer()</TT
> and <TT
CLASS="FUNCTION"
>H5Perf_endTimer()</TT
>.
In the <TT
CLASS="FILENAME"
>write.c</TT
> example that we used in the previous subsection, look for the above APIs near line 110. 
It'll look like below program listing:</P
>
<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>  H5Perf_startTimer(&#38; start);
  
  /* BEGIN: Insert your custom benchmark program here */
  status = H5Dwrite(dataset, H5T_NATIVE_INT, H5S_ALL, H5S_ALL,
		    H5P_DEFAULT, data);
  /* END */
  
  time_used = H5Perf_endTimer(start);</PRE
></TD
></TR
></TABLE
>
<P
>In the above example, you're measuring the "H5Dwrite" performance of writing "data" which is initialized near the line 70 of the <TT
CLASS="FILENAME"
>write.c</TT
> file: </P
>
<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>  /*
   * Data and output buffer initialization.
   */
  data = (int*)malloc(sizeof(int)*dx*dy);
  tempdata = data;
    
  for (j = 0; j &#60; dy; j++) {
    for (i = 0; i &#60; dx; i++){
      *tempdata = i + j;
      tempdata++;
    }
  }</PRE
></TD
></TR
></TABLE
>
<P
>As you can see, "data" initialization is not part of performance measure and done at the beginning of the program. It is important to wrap the target function(s) only that you want to measure for a long period of time. In our example, irrelevant parts of custom program like HDF5 file creation are outside of the two envelop APIs -- <TT
CLASS="FUNCTION"
>H5Perf_startTimer()</TT
> and <TT
CLASS="FUNCTION"
>H5Perf_endTiemr()</TT
>.</P
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="x196.html"
ACCESSKEY="P"
>&#60;&#60;&#60; Previous</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="book1.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="c229.html"
ACCESSKEY="N"
>Next &#62;&#62;&#62;</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>4.2 Creating Custom Routine, Action and Instance Name</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="c160.html"
ACCESSKEY="U"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Testing HPF</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>